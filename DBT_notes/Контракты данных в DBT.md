**Контракты данных** _—_ это договоренности между поставщиками и потребителями данных о том:
- в каком виде данные будут приходить (**структура**: наличие определенных колонок и отсутствие лишних и **типы данных** [[Модели в DBT|модели]]), 
- с какой частотой они будут обновляться.
Они нужны, чтобы данные от поставщиков были **предсказуемыми** и соответствовали ожиданиям потребителей.

Контракты есть смысл применять к конечным витринам, у которых есть [[Потребители данных (exposures) в DBT|потребители]].

Практическая реализация контрактов данных в DBT обеспечивается при помощи проверок [[Проверки на свежесть источников в DBT|свежести источников]], а также прочих [[DQ проверки в DBT|DQ проверок]] (на [[Тесты в DBT#Тест на согласованность двух таблиц (Relationships)|согласованность]], [[Тесты в DBT#Тест на уникальность (UNIQUE)|уникальность]], полноту данных).

Для того, чтобы **внедрить контракт** в [[Модели в DBT|модель]] DBT необходимо:
1. Описать названия (name), описания (description) и типы данных (data_type) всех колонок модели в разделе `columns` файла `properties.yml`
2. Включить (`enforced: true`) опцию проверки контракта в том же файле в разделе `contract` модели.

Пример реализации контракта для модели:
```yml
models:
	- name: "revenue_daily"
	  description: "Daily revenue aggregate"
	  config:
		  materialized: "incremental"
		  full_refresh: false
		  strategy: "merge"
		  unique_key: [date]
		  on_schema_change: "append_new_columns"
		  contract:
			  enforced: true
		  columns:
			  - name: "revenue_rub"
			    description: "Daily revenue in rubles"
			    data_type: "decimal(20, 2)"
			  - name: "date"
			    description: "Unique day"
			    data_type: "date"
			  - name: "updated_at"
			    description: "When row was updated last time"
			    data_type: "timestamptz"
```

Выполнения контракта проверяется **перед материализацией модели**. Если нарочно некорректно поменять тип данных какого-то из атрибутов, то модель не обновится.
В этом состоит главное отличие контрактов от тестов: контракты работают превентивно, не позволяя материализоваться некорректным моделям, тесты выполняются постфактум. 

Наличие контракта данных будет отображаться в [[Каталог данных в DBT|каталоге данных]], что позволит понять потребителям, что данные в модели - надежные.
![[Data contract DBT.png]]