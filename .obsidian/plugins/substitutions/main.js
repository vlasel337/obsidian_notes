/* THIS IS A GENERATED/BUNDLED FILE BY ESBUILD see https://github.com/BambusControl/obsidian-substitutions for the source */
"use strict";var v=Object.defineProperty,mt=Object.defineProperties,ft=Object.getOwnPropertyDescriptor,pt=Object.getOwnPropertyDescriptors,bt=Object.getOwnPropertyNames,q=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable;var J=(i,t,e)=>t in i?v(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,u=(i,t)=>{for(var e in t||(t={}))W.call(t,e)&&J(i,e,t[e]);if(q)for(var e of q(t))St.call(t,e)&&J(i,e,t[e]);return i},c=(i,t)=>mt(i,pt(t));var gt=(i,t)=>{for(var e in t)v(i,e,{get:t[e],enumerable:!0})},ht=(i,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of bt(t))!W.call(i,r)&&r!==e&&v(i,r,{get:()=>t[r],enumerable:!(o=ft(t,r))||o.enumerable});return i};var Rt=i=>ht(v({},"__esModule",{value:!0}),i);var s=(i,t,e)=>new Promise((o,r)=>{var n=l=>{try{a(e.next(l))}catch(f){r(f)}},d=l=>{try{a(e.throw(l))}catch(f){r(f)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(n,d);a((e=e.apply(i,t)).next())});var wt={};gt(wt,{default:()=>F});module.exports=Rt(wt);var ut=require("obsidian");var x=require("obsidian");var Q=require("obsidian");function g(i){return i.from!=""&&i.to!=""}function B(i,t){let e=t=="",o=i.settingEl.hasClass("filled-substitution");return e||o?!1:(i.settingEl.addClass("filled-substitution"),!0)}function G(i){return i.replace(/\\[ntb\\]/g,t=>({"\\n":`
`,"\\t":"	","\\b":"\b","\\\\":"\\"})[t]||t)}function K(i){return i.replace(/[\n\t\b\\]/g,t=>({"\n":"\\n","	":"\\t","\b":"\\b","\\":"\\\\"})[t]||t)}function N(i){return(i?"Disable":"Enable")+" substitution"}var p=class{constructor(t,e,o=()=>{}){this._record=t;this._container=e;this._onFill=o;this.setting=null}get record(){return this._record}display(){if(this.setting!=null)return this.setting;let t=this._record,e=new Q.Setting(this._container).setClass("substitution-record");return g(t)&&e.setClass("filled-substitution"),e.addToggle(o=>{o.setTooltip(N(o.getValue())).setValue(t.enabled).onChange(r=>{t.enabled=r,o.setTooltip(N(r))}),o.toggleEl.addClass("hide-if-empty")}).addText(o=>{o.setPlaceholder("replace this").onChange(r=>{t.from=r}).setValue(t.from),this.fromInput=o}).addExtraButton(o=>{o.setIcon("arrow-left-right").setTooltip("Swap from and to").onClick(()=>{var d,a;let r=""+t.to,n=""+t.from;t.from=r,t.to=n,(d=this.fromInput)==null||d.setValue(r),(a=this.toInput)==null||a.setValue(n)}),o.extraSettingsEl.addClass("hide-if-empty")}).addText(o=>{o.setPlaceholder("with this").onChange(r=>s(this,null,function*(){t.to=G(r),B(e,t.to)&&(e.setClass("filled-substitution"),yield this._onFill())})).setValue(K(t.to)),this.toInput=o}).addExtraButton(o=>{o.setIcon("x").setTooltip("Remove substitution").onClick(()=>{t.action=2,e.settingEl.hide()}),o.extraSettingsEl.addClass("hide-if-empty")}),this.setting=e,e}};function X(i){return c(u({from:"",to:"",enabled:!0},i),{id:-1,action:1})}function h(i,t,e){let o=new p(X(e),i,()=>{h(i,t).display()});return t.unshift(o),o}var D=class extends x.PluginSettingTab{constructor(e,o,r){super(e,o);this.dataStore=r;this.rendered=!1;this.storedRecords=[];this.newRecords=[];this.containerEl.addClass("plugin","substitutions","settings-tab")}display(){return s(this,null,function*(){if(this.rendered)return;let e=this.containerEl.createDiv({cls:"heading"});new x.Setting(e).setHeading().setName("Substitutions").setDesc("Here you can set and enable automatic text substitutions. Auto paired characters, like brackets, currently do not work.");let o=this.containerEl.createDiv({cls:["substitutions-list","new"]}),r=this.containerEl.createDiv({cls:"substitutions-list"});this.storedRecords=(yield this.dataStore.getModifiableSubstitutionRecords()).map(n=>new p(n,r)),h(o,this.newRecords);for(let n of this.records)n.display();this.rendered=!0})}hide(){return s(this,null,function*(){yield this.dataStore.overwriteSubstitutionRecords(this.records.map(e=>e.record))})}get records(){return[...this.newRecords,...this.storedRecords]}};var w=class extends Error{};var y=class{constructor(t,e,o){this.getCallback=t;this.persistCallback=e;this.value=o}get(){return s(this,null,function*(){return this.value==null&&(this.value=yield this.getCallback()),this.value})}set(t){this.value=t}persist(){return s(this,null,function*(){if(this.value==null)throw new w("Refuse to persist a null value");return yield this.persistCallback(this.value),this.value})}};var b="0.1.0";function E(){return{initialized:!1,version:b,substitutions:{initialized:!1,records:[{from:"...",to:"\u2026",enabled:!0},{from:"1/2",to:"\xBD",enabled:!0},{from:"1/3",to:"\u2153",enabled:!0},{from:"1/4",to:"\xBC",enabled:!0},{from:"1/5",to:"\u2155",enabled:!0},{from:"1/6",to:"\u2159",enabled:!0},{from:"1/7",to:"\u2150",enabled:!0},{from:"1/9",to:"\u2151",enabled:!0},{from:"1/10",to:"\u2152",enabled:!0},{from:"1/8",to:"\u215B",enabled:!0},{from:"2/3",to:"\u2154",enabled:!0},{from:"2/5",to:"\u2156",enabled:!0},{from:"3/4",to:"\xBE",enabled:!0},{from:"3/5",to:"\u2157",enabled:!0},{from:"4/5",to:"\u2158",enabled:!0},{from:"5/6",to:"\u215A",enabled:!0},{from:"3/8",to:"\u215C",enabled:!0},{from:"5/8",to:"\u215D",enabled:!0},{from:"7/8",to:"\u215E",enabled:!0},{from:"<--",to:"\u2190",enabled:!0},{from:"-->",to:"\u2192",enabled:!0},{from:"<->",to:"\u2194",enabled:!0},{from:"<==",to:"\u21D0",enabled:!0},{from:"==>",to:"\u21D2",enabled:!0},{from:"<=>",to:"\u21D4",enabled:!0},{from:"--",to:"\u2013",enabled:!1},{from:"---",to:"\u2014",enabled:!1},{from:"!=",to:"\u2260",enabled:!0},{from:"<=",to:"\u2264",enabled:!0},{from:">=",to:"\u2265",enabled:!0},{from:"~=",to:"\u2245",enabled:!0},{from:"+-",to:"\xB1",enabled:!0},{from:"-+",to:"\u2213",enabled:!0},{from:"<<",to:"\u226A",enabled:!0},{from:">>",to:"\u226B",enabled:!0}]}}}function Y(i){return i!=null&&"initialized"in i&&"version"in i}function Z(i){return s(this,null,function*(){let t=yield i.loadData();return Y(t)?t:u({},E())})}var P=class{constructor(t){this.dataLoader=t;this.storedData=new y(()=>Z(t),e=>t.saveData(e))}isInitialized(){return s(this,null,function*(){let t=yield this.storedData.get();return t.initialized&&t.version===b})}setInitialized(t){return s(this,null,function*(){yield this.mergeData({initialized:t})})}isCurrentVersion(){return s(this,null,function*(){return(yield this.storedData.get()).version===b})}getSubstitutions(){return s(this,null,function*(){return(yield this.storedData.get()).substitutions})}overwriteSubstitutions(t){return s(this,null,function*(){return(yield this.mergeData({substitutions:t})).substitutions})}setInitializedSubstitutions(t){return s(this,null,function*(){let e=yield this.getSubstitutions(),o=c(u({},e),{initialized:t});yield this.overwriteSubstitutions(o)})}mergeData(t){return s(this,null,function*(){let e=yield this.storedData.get(),o=c(u(u({},e),t),{version:t.initialized?b:e.version});return this.storedData.set(o),yield this.storedData.persist()})}};var C=class{constructor(t){this.dataStore=t}initializeData(){return s(this,null,function*(){yield this.initializeAll()})}initializeAll(){return s(this,null,function*(){(yield this.dataStore.isInitialized())||((yield this.dataStore.isCurrentVersion())||(yield this.dataStore.setInitialized(!1),yield this.dataStore.setInitializedSubstitutions(!1)),yield this.initializeSubstitutions(),yield this.dataStore.setInitialized(!0))})}initializeSubstitutions(){return s(this,null,function*(){(yield this.dataStore.getSubstitutions()).initialized||(yield this.dataStore.overwriteSubstitutions(c(u({},E().substitutions),{initialized:!0})))})}};function j(i,t){return c(u({},i),{id:t,action:0})}function $(i){return{from:i.from,to:i.to,enabled:i.enabled}}function H(i){return i.action!=2}var T=class{constructor(t,e){this.store=t;this.substitutionsModifiedCallback=e}getSubstitutionRecords(){return s(this,null,function*(){return(yield this.store.getSubstitutions()).records})}getModifiableSubstitutionRecords(){return s(this,null,function*(){return(yield this.getSubstitutionRecords()).map(j)})}overwriteSubstitutionRecords(t){return s(this,null,function*(){let e=yield this.store.getSubstitutions(),r=new Array(...t.values()).filter(g).filter(H).map($),n=yield this.store.overwriteSubstitutions(c(u({},e),{records:r}));this.substitutionsModifiedCallback(n.records)})}addSubstitutionRecords(t){return s(this,null,function*(){let e=yield this.store.getSubstitutions(),o=e.records,n=new Array(...t.values()).filter(g).filter(H).map($),d=yield this.store.overwriteSubstitutions(c(u({},e),{records:[...n,...o]}));this.substitutionsModifiedCallback(d.records)})}};var tt=require("@codemirror/view");function S(i){return u(u({},vt),i)}var vt={cache:"",length:0,matches:[],substitution:null};var M=require("@codemirror/state"),m={update:M.StateEffect.define(),substitute:M.StateEffect.define(),revert:M.StateEffect.define()};function L(i){return i.update({effects:[m.update.of(null)]})}var O=require("@codemirror/state");function z(i,t,e){let o=i.changeByRange(r=>{let n=O.EditorSelection.range(r.anchor-(t.length-1),r.head),d=n.from+e.length;return{range:O.EditorSelection.cursor(d),changes:[{insert:e,from:n.from,to:n.to}],effects:[m.substitute.of({from:t,to:e,endPosition:d-1})]}});return i.update(o)}function et(i){return tt.EditorView.inputHandler.of((t,e,o,r,n)=>{var U;if(!!(t.compositionStarted||t.state.readOnly))return!1;let a=t.state.selection.main,l=r.length!==1,f=e===a.from&&o===a.to;if(l||!f)return!1;let V=(U=t.state.field(i,!1))!=null?U:S(),lt=(V.cache+r).slice(-V.length),A=V.matches.find(ct=>lt.endsWith(ct.from)),dt=A!=null?[L(t.state),z(t.state,A.from,A.to)]:[n(),L(t.state)];return t.dispatch(...dt),!0})}var it=require("@codemirror/view");function ot(i){return it.EditorView.updateListener.of(t=>{var a,l;if(!t.transactions.some(f=>f.isUserEvent("delete.backward")))return;let o=t.state,r=o.selection.main;if(r.from!==r.to)return;let n=(a=o.field(i,!1))!=null?a:S(),d=r.to===((l=n.substitution)==null?void 0:l.endPosition)?Dt(o,n.substitution):xt(o);t.view.dispatch(...d)})}function Dt(i,t){let e=z(i,t.to,t.from),o=i.update({effects:[m.revert.of(null)]});return[e,o]}function xt(i){return[i.update({effects:[m.update.of(null)]})]}var nt=require("@codemirror/state");function rt(i,t){let e=i.selection.asSingle().main.head,o=Math.max(0,e-t);return i.sliceDoc(o,e)}function st(i){let t=i.filter(n=>n.enabled),e=t.map(n=>n.from.length),o=Math.max(...e),r=n=>S(u({length:o,matches:t},n));return nt.StateField.define({create(){return r()},update(n,d){let a=n;for(let l of d.effects)l.is(m.update)?a=c(u({},a),{cache:rt(d.state,a.length)}):l.is(m.substitute)?a=c(u({},a),{substitution:{from:l.value.from,to:l.value.to,endPosition:l.value.endPosition}}):l.is(m.revert)&&(a=c(u({},a),{substitution:null}));return a}})}function at(i){let t=st(i);return[t,et(t),ot(t)]}var R=class i{static replaceAndUpdate(t,e,o){i.replaceExtensions(t,e),o.updateOptions()}static replaceAndRegister(t,e,o){i.replaceExtensions(t,e),o.registerEditorExtension(t)}static replaceExtensions(t,e){for(;t.length>0;)t.pop();t.push(at(e))}};var k=require("obsidian");var I=class extends k.Modal{constructor(e,o,r){super(e);this.dataStore=o;this.placeholderValue=r;this.newRecords=[]}onOpen(){return s(this,null,function*(){var a;let e=new DocumentFragment,o=e.createDiv();o.addClass("plugin","substitutions","add-substitution-modal");let r=o.createDiv({cls:"heading"});new k.Setting(r).setDesc("Auto paired characters, like brackets, currently do not work.");let n=o.createDiv({cls:["substitutions-list","new"]}),d=h(n,this.newRecords,{from:this.placeholderValue});for(let l of this.newRecords)l.display();this.setTitle("Add new substitution"),this.setContent(e),(a=d.fromInput)==null||a.inputEl.focus()})}onClose(){return s(this,null,function*(){yield this.dataStore.addSubstitutionRecords(this.newRecords.map(e=>e.record))})}};var F=class extends ut.Plugin{constructor(t,e){super(t,e),this.extensions=[]}onload(){return s(this,null,function*(){let t=new P(this),e=new C(t),o=new T(t,n=>R.replaceAndUpdate(this.extensions,n,this.app.workspace));yield e.initializeData();let r=yield o.getSubstitutionRecords();R.replaceAndRegister(this.extensions,r,this),this.addSettingTab(new D(this.app,this,o)),this.addCommand({id:"add-substitution",name:"Add Substitution",editorCallback:(n,d)=>{new I(this.app,o,n.getSelection()).open()}})})}};

/* nosourcemap */