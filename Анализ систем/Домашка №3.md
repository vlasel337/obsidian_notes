После просмотра разбора домашки я внес изменения в разделение системы на поддомены и боундед контексты в соответствии со схемой, которую показывал Антон.
В этой связи Event Storming, который я делал в рамках первых двух домашек перестал быть актуальным и нуждается в доработках, которые я конечно же не сделаю.

В ДЗ №3 я сперва вынес на борду всех стейкхолдеров с их консернами, затем раскидал стейкхолдеров на матрицу. При этом я решительно не понимаю на чем должны основываться размещения стейкхолдеров в тех или иных квадрантах кроме как на моем субъективном мнении (авторитетный подход: "кажется, что так будет норм").

Далее я переделал общую схему системы и раскидал по боуднед-контекстам архитектурные характеристики, которые взялись из консернов стейкхолдеров и в результате анализа требований, выполненного в ДЗ №2.

Ниже приведены комментарии по конкретным блокам ДЗ.

# Стейкходлдеры
Матрица со стейкхолдерами, а также табличка с консернами в Miro.

Распределять стейкхолдеров по матрице оказалось не так просто, как я думал. Сложности возникли с тем, что не понятно как сравнивать уровни влияния и интереса стейкхолдеров друг относительно друга. Ориентировался на аналогичную матрицу в уроке и собственные представления о характеристиках стейкхолдеров.

Выделил дополнительных стейкхолдеров, мнение которых стоит учитывать:
1. В качестве отдельного стейкхолдера можно выделить группу **разработчиков, которые будут заниматься алгоритмом матчинга** (скорее всего им будут заниматься в том числе и специалисты по data science). 
2. Также стоит выделить **аналитиков**, которые будут тестировать продуктовые гипотезы.
3. В проекте много персональных данных клиентов и воркеров, в связи с чем может возникнуть вопросы от **офицеров безопасности**, которых тоже стоит включить в группу стейколдеров.
4. Дополнительно в отдельных стейкхолдеров можно выделить работников склада, представителей организаций, с которыми будут осуществлены интеграции (например, поставщики печенья), дизайнеров, представителей соседней системы Happy Cat Box, которая является точкой входа в MCF.

Дополнительно раскрасил стикеры с консернами в красный и зеденый цвета по аналогии с тем, что было в уроке (зеленый – учитываем, зеленый – прислушиваемся, но не бежим реализовывать).

# Выбор архитектурного стиля
Судя по таблице со звездочками под архитектурные характеристики, которые заявлены в системе, лучше всего подходят стили Microservices и Event-driven. Подозреваю, что разница между ними состоит в основном в стиле коммуникации, поэтому сделаю выбор в пользу Microservices (курс по EDA не проходил, поэтому не имею компетенции для того, чтобы лезть в асинхронные паттерны).

На мой взгляд для системы лучше всего подойдет распределенный микросервисный архитектурный стиль, так как:
1. Согласно новым вводным в сервисе увеличивается нагрузка (с 10 заказов в день до 10 заказов в минуту), а значит и растет необходимость в scalability.
2. В разных частях системы нагрузка будет неравномерной.
3. В разных модулях системы необходимо соблюсти разный уровень конфиденциальности.
4. Есть модули системы, в которых отличный от общесистемного релизный цикл.
5. Система должна обеспечивать высокий availability (работать без сбоев), maintainability (быстро восстанавливаться в случае падения), performance (работать "без тупняков").
6. У компании есть деньги на реализацию инфраструктуры.

Обоснования выделение каждого из сервисов, а также выбор БД под каждый из них:

| Сервис                                                                                                                                             | Обоснование                                                                                                                                                                                                                                                                                                                                                                      | Стиль                                                                                                                                                                                                                      | БД                                                                                                                                              |     |
| -------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| Мотивация менеджеров                                                                                                                               | У менеджеров есть консерн по сокрытию системы ставок от разработчиков, которые не будут ей заниматься, других отделов и от начальства. Для его удовлетворения стоит выделить отдельный сервис для ставок.                                                                                                                                                                        | **layered monolith**<br>(Дешевое и простое решение с высоким deployability)                                                                                                                                                | **RDBMS**<br>(Чувствительные данные о транзакциях, требуется консистентость)                                                                    |     |
| Подбор наилучшего исполнителя на заказ                                                                                                             | Согласно консерну топ-менеджмента у модуля матчинга должен быть отличный от общесистемного релизный цикл. Также в будущем топ-менеджмент хочет продавать логику скоринга другим компаниям и тестировать больше гипотез. Это является аргументами для выделения матчинга в отдельный сервис.                                                                                      | **pipeline**<br>(Алгоритм матчинга состоит из набора шагов и чем-то похож на map-reduce)                                                                                                                                   | **Графовая БД**<br>(Лучше всего подходит для стиля pipeline)                                                                                    |     |
| Найм лучших воркеров                                                                                                                               | Отдельный core поддомен с важной для бизнеса логикой и высокой сложностью.                                                                                                                                                                                                                                                                                                       | **miсrokernel**<br>(Решение с высоким deployability, а также с с отдельными плагинами для каждого способа тестирования)                                                                                                    | **Документная БД**<br>(Так как тесты неструктурированы, могут иметь разные наборы полей, также могут содержаться фото воркеров и их документов) |     |
| Закрытие потребности клиентов<br>(это generic поддомен, соответственно, его реализация – дело рук провайдера, но все-таки предложу стиль и БД)<br> | В сервисе будут реализованы процессы резервирования воркера под задачу и функционал контроля качества исполнения заказа.<br>Также внутри сервиса будет два отдельных контекста, которые будут работать с информацией одного типа (финансовые данные) и нефункциональные требования финотдела к каждому из них одинаковы: гарантия того, что финансовая информация не потеряется. | **moduled monolith**<br>(В сервисе будет реализовано сразу 4 боундед-контекста, как будто бы напрашивается модульность. Допускаю, что тут можно выбрать даже service-based style, если контекстам нужна большая автономия) | **RDBMS**<br>(Для обеспечения ACID)                                                                                                             |     |
| Ускорение выполнения заказа<br>(это generic поддомен, соответственно, его реализация – дело рук провайдера, но все-таки предложу стиль и БД)       | В целом этот сервис можно включить в предыдущий (сделать одним из модулей), но мне кажется, что не стоит его перегружать. + в сервисе есть логика взаимодействия с внешним провайдером, которую тоже хочется изолировать.                                                                                                                                                        | **layered monolith**                                                                                                                                                                                                       | **RDBMS**  <br>(Для простоты. Но можно упороться и сделать Документную БД, если в сервисе наблюдается какая-то неструктурированность)           |     |
Я понимаю, что выбирать большой зоопарк из видов БД (колоночная, документая, RDBMS) – на практике не лучшее решение, так как далеко не факт, что в команде есть экспертиза по работе с ними. Тем не менее в условиях курса я допустил такую неосмотрительность.

# Коммуникации
В плане коммуникаций в моей системе все достаточно просто. Так как больше всего взаимодействий происходит с generic поддоменами, реализованными сторонними разработчиками во внешних сервисах, коммуникация с ними будет производиться по синхронному request-response варианту. 

Единственную асинхронную коммуникацию я добавил между сервисами для найма лучших воркеров и для подбора наилучшего исполнителя на заказ, чтобы снизить между ними coupling и иметь возможность контролировать нагрузку перетекаемую из одного сервиса в другой (использовать брокер сообщений, как load balancer).

# Фитнесс-функции
Я бы выделил следующие фитнес функции:
1. Внедрить health-check эндпойнт в каждом из сервисов для мониторинга доступности и жизнеспособности всех сервисов системы (**availability**).
2. Внедрить алертинг разработчиков и админов с указанием на место поломки в случае, если какой-то сервис вышел из строя (**observability**, **maintainability**).
3. Добавить оценку покрытия кода тестами через code coverage и требование, что система должна быть покрыта тестами на 90% (проверка **testability**).
4. Перформанс-тесты, которые оценивают соответствие системы определённому значению **performance**.
5. Внедрить регулярное прохождение нагрузочных тестов (для оценки **scalability** и **elasticity**).
6. Обсудить с менеджментом контроль регулярности релизов и настроить анализ метрик в Jira: проверка периодичности релиза не реже раза в две/одну неделю (проверки скорости релиза фичи **deployability**).

# ADR

## ADR-001: Выбор архитектурного стиля для сервиса подбора наилучшего исполнителя на заказ

### Status: _Accepted_

### Context
После анализа требований было выяснено, что:
- алгоритм матчинга состоит из набора шагов, по которым рассчитываются рейтинги и другие значения,
- система чем-то похожа на map-reduce,
- важно иметь возможность расставлять реализованные шаги в нужной бизнесу последовательности, которая иногда может изменяться, при этом необходимо иметь возможность добавлять или редактировать шаги (**modifiability**, **agility**).

Также было установлено, что у модуля матчинга должен быть отличный от общесистемного релизный цикл (одна неделя) (**deployability**), и в будущем топ-менеджмент хочет продавать логику скоринга другим компаниям (**scalability**, **elasticity**) и тестировать больше гипотез (**testability**).

Кроме того, алгоритм матчинга сам по себе имеет коммерческую ценность и не должен стать достоянием общественности (**security**).

### Decision: стиль pipeline
Было принято решение о вынесении модуля матчинга в отдельный сервис, так как его характеристики отличаются от общесистемных, а также у него есть потенциал для развития в отдельный продукт, у алгоритма матчинга есть коммерческая тайна. 

На основе архитектурных характеристик, описанных в контексте, было принято решение о выборе для сервиса архитектурного стиля pipeline, так как:
- он наилучшим образом соответствует характеристикам, 
- а также логика алгоритма матчинга схожа с логикой MapReduce, который как раз использует стиль pipeline.

Для БД сервиса была выбрана колоночная БД, так как она лучше всего справляется с однотипными потоковыми данными, которые будет генерить и анализировать алгоритм.

### Сompliance
Для проверки реализации архитектурного стиля pipeline необходимо ввести следующие фитнес функции:
- FF для определения разделения системы на независимые **фильтры (filters)**, каждый из которых выполняет одну функцию.
- FF для проверки однонаправленности потока данных (pipes) между фильтрами.
- FF для проверки соответствия контрактов между стадиями.

