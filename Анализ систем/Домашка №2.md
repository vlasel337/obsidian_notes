
Ссылка на Miro со схемами: https://miro.com/app/board/uXjVJ6nwoJA=/
Комментарии к схемам ниже.
## Business domain
Бизнес-домен: продукт Make Cats Free (MCF) решает проблему увеличения эффективности клиентов за счет снятия с них нагрузки по решению повседневных бытовых вопросов и делегирования ее профессиональным воркерам, входящим в топ 3%.

Поддомены:
1. **Онбординг новых воркеров**. Решает проблему найма, тестирования и отсева новых воркеров.
2. **Заявки на услуги и их матчинг с воркерами**. Решает проблему постановки задачи на выполнение заказа (выбора из перечня услуг) и проблему подбора подходящего воркера под услугу, заявку на которую оставил клиент. Внутри этого поддомена будет два боундед-контекста: 1) контекст клиента и заявки, 2) контекст матчинга заявки и воркера.
3. **Выполнение заказа**. Решает проблему выполнения услуги, заказанной клиентом. 
4. **Снабжение**. Решает проблему подготовки расходников для успешного выполнения заказа.
5. **Ставки**. Решает проблему мотивации нынешних менеджеров и привлечения новых менеджеров в компанию.
6. **Контроль/оценка качества**. Решает проблему оценки качества заказов, выяснения причин провала заказов, заглаживания инцидентов.
7. **Биллинг**. Решает проблему оплаты труда воркеров, а также проблему списания средств у клиентов.

## Core Domain Chart
(приложил на Miro)
![[Core Domain Chart.png|500]]

Обоснование разделения поддоменов по типам:

| Домен                                                                       | Тип          | Обоснование                                                                                                                                                                                                                                                                                                                     |
| --------------------------------------------------------------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1) Онбординг новых воркеров<br>2) Заявки на услуги и их матчинг с воркерами | Core<br><br> | В требованиях написано: "Благодаря отсеву и матчингу MCF планирует выделяться на фоне конкурентов. Компания планирует использовать самые передовые алгоритмы отсева воркеров и самый совершенный матчинг между котами-клиентами". В этой связи поддомены онбординга (отсева воркеров) и заявки и мэтчинга попали в группу Core. |
| Выполнение заказа                                                           | Support      | Поддомен обработки заказа достаточно сложный в разработке (там много логики), но он не несет в себе какого-то уникального конкурентного преимущества или ценности для клиента, при большом желании его можно заменить на готовое коробочное решение (по типу Salesforce).                                                       |
| Контроль качества                                                           | Support      | Поддомен контроля качества попроще в разработке, но также не имеет уникальной отличительной особенности, без которой бизнес потеряет свою идентичность. При желании эта функция может быть отдана на аутсорс.                                                                                                                   |
| Ставки                                                                      | Support      | Поддомен ставок не сложный с точки зрения разработки, будет редко меняться, не особо приоритетный и также может быть отдан на аутсорс. Тем не менее хочется сделать его инхаус, так как это внутренняя фишка продукта, которая несет ценность для менеджеров.                                                                   |
| 1) Снабжение<br>2) Биллинг<br><br>                                          | Generic      | Поддомен биллинга и поддомен снабжения отвечают за стандартные проблемы, с которыми сталкивается любой бизнес. Они не несут в себе уникальной ценности и интереса. Причин за то, чтобы не взять готовые решения для этих функций, не много.                                                                                     |
Описание схемы соотношения поддоменов и контекстов:
- Получилось, что практически каждому из доменов соответствует свой отдельный контекст.
- Только для поддомена заявки пришлось выделить сразу два контекста, так как, по информации из требований, разработчики алгоритма матчинга отказываются переучиваться от своей терминологии.

## Исправленный Event Storming
Переделал модель ES с первого урока (старый ES в Miro выше):
- исправил ошибки в нотации стикеров,
- начал соблюдать строгое хронологическое расположение процессов и контекстов,
- исправил связи между стикерами внутри контекстов (сohesion) и между контекстов (coupling),
- убрал объяснение технической реализации, чтобы не лишать себя пространства вариантов,
- убрал нотификейшены, так как это техничк, 
- перегруппировал события по контекстам на основе выделенных поддоменов.

Постарался сделать ES максимально простым и читабельным, без оверинжиниринга.

Если концептуально сравнивать ES из второго урока с ES из первого урока, то отличия в подходах по группировке контектов обусловленты тем, что при первом подходе к ES я тупо шел по требованиям, выписывал события, а потом группировал их по акторам. Во второй итерации я реорганизовал группировку событий в соответствии с бизнес поддоменами.

Пока что в ES я все еще не понимаю:
- Зачем нужны фиолетовые policy-стикеры в проекте из домашки?
- Нормально ли, что у меня акторами являются "Алгоритм ставок", "Алгоритм матчинга",  "Крона  еженедельная", "Крона ежемесячная"? По сути это же не совсем лица, принимающие решения. Если такие акторы некорректны, то как их заменить?

## Архитектурные характеристики

| Характеристика        | Источник        | Описание                                                                                                                                                                                                                                                                                                                                                                |
| --------------------- | --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Scalability           | Требования      | Заявлено, что "компания планирует расширяться в будущем".                                                                                                                                                                                                                                                                                                               |
| Elasticity            | Требования      | В системе возможны пики нагрузки, в том числе и злонамеренные DDOS атаки от конкурентов.                                                                                                                                                                                                                                                                                |
| Security              | Требования      | Доступ к алгоритму матчинга должен быть ограничен, так как – это коммерческая тайна: "разработчики не хотят делиться алгоритмом". Также в системе много ПД, которую также нужно шифровать.                                                                                                                                                                              |
| Fault tolerance       | Требования      | Из-за возможных атак конкурентов система должна быть устойчивой к внешним атакам.                                                                                                                                                                                                                                                                                       |
| Modifiability         | Требования      | Чтобы алгоритм матчинга и алгоритм подбора воркеров оставались инновационными, нужно поддерживать их в актуальном состоянии. Для этого системе явно требуется возможность внесения регулярных изменений и доработок, которые бы можно было без труда вносить. В то же время для других частей системы (например, для поддомена ставок) эта характеристика не так важна. |
| Usability             | Требования      | В требованиях есть моножество пунктов (\[US-140], \[US-170], \[US-260]), которые свидетельствуют о том, что клиентская сторона системы должна быть удобной и информативной. Лояльность клиентов и вовлеченность менеджеров важна для проекта.                                                                                                                           |
| Agility (Testability) | Требования      | Согласно требованию \[US-210], компания планирует тестировать гипотезы для для улучшения бизнеса.                                                                                                                                                                                                                                                                       |
| Deployability         | Общие положения | "Бизнесу необходим низкий ТТМ (Time To Market), чтобы конкурировать на рынке".                                                                                                                                                                                                                                                                                          |
| Consistency           | Додумал сам     | В системе много последовательных событий. Согласно требованиям, у клиентов, воркеров и менеджеров должна быть информация о текущем состоянии их нынешних и архивных заявок, заказов, ставок, платежей (\[US-250], \[US-260]). В этой связи я думаю, что для системы важна консистентность, особенно для участков, связанных с деньгами (поддомены биллинга и ставок).   |
| Availability          | Додумал сам     | Так как для компании важна лояльность ее клиентов система должна обеспечивать высокий уровень своей доступности (не менее 99%).                                                                                                                                                                                                                                         |

## Выбор архитектурного стиля проекта
Аргументы:
- На момент разработки нагрузка на систему мизерная можно не спешить с реализацией полностью распределенной микросервисной системы, так как это усложнит разработку и займет больше времени. Даже если учесть, что проект планирует масштабироваться и выходить на новые клиентские сегменты, это явно займет много времени (на момент проектирования ниша ЦА достаточно узкая).
- Модульность важна для системы, так как она обеспечивает отказоустойчивость, которая необходима в виду возможных всплесков нагрузки и атак со стороны конкурентов.
- Судя по требованиям, деньги – не проблема.
- Разные части системы имеют разные приоритеты, сложность и желаемую частоту обновления, поэтому напрашивается модульный стиль архитектуры.

Я считаю, что по состоянию на конец 2 урока, имея требования в текущем виде и проанализировав архитектурные характеристики, лучшим решением по выбору архитектурного стиля будет гибридный **service-based architecture style** (набор отдельных сервисов с общей БД).

## Итоговая модель системы
Итоговая модель системы состоит из 7 отдельных сервисов, которые будут жить на одной БД. Практически все связи в системе будут синхронными. Асинхронные взаимодействия будут только с сервисом снабжения и сервисом контроля качества.






